# ‚úÖ Docker –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤!

## –û—Å–Ω–æ–≤–Ω–æ–π docker-compose.yml –æ–±–Ω–æ–≤–ª–µ–Ω

–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è —Ñ–∞–π–ª–∞!

---

## üöÄ –ó–∞–ø—É—Å–∫ (–æ–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π)

### Windows (–¥–≤–æ–π–Ω–æ–π –∫–ª–∏–∫):
```
docker-start.bat
```

### –ö–æ–º–∞–Ω–¥–Ω–∞—è —Å—Ç—Ä–æ–∫–∞:
```bash
# –ë—ã–ª–æ (—Å—Ç–∞—Ä–æ–µ):
docker-compose -f docker-compose.simple.yml up -d

# –°—Ç–∞–ª–æ (–Ω–æ–≤–æ–µ):
docker-compose up -d
```

---

## üéÆ –í—Å–µ –∫–æ–º–∞–Ω–¥—ã (—É–ø—Ä–æ—â–µ–Ω–Ω—ã–µ)

### –ó–∞–ø—É—Å–∫
```bash
docker-compose up -d
```

### –ó–∞–ø—É—Å–∫ —Å –ø–µ—Ä–µ—Å–±–æ—Ä–∫–æ–π
```bash
docker-compose up --build -d
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞
```bash
docker-compose down
```

### –õ–æ–≥–∏
```bash
docker-compose logs -f
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
```bash
docker-compose restart
```

### –ü–µ—Ä–µ—Å–±–æ—Ä–∫–∞
```bash
docker-compose build --no-cache
docker-compose up -d
```

---

## üîß –ß—Ç–æ –±—ã–ª–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –≤ docker-compose.yml

### 1. PostgreSQL volume path
```yaml
# –ë—ã–ª–æ:
volumes:
  - postgres_data:/var/lib/postgresql/data

# –°—Ç–∞–ª–æ:
volumes:
  - postgres_data:/var/lib/postgresql
```

### 2. FRONTEND_URL
```yaml
# –ë—ã–ª–æ:
FRONTEND_URL: http://localhost:3000

# –°—Ç–∞–ª–æ:
FRONTEND_URL: http://localhost:5000
```

### 3. Health checks
```yaml
# –£–±—Ä–∞–ª–∏ —Å–ª–æ–∂–Ω—ã–µ health checks
# –¢–µ–ø–µ—Ä—å –ø—Ä–æ—Å—Ç–æ depends_on: - db
```

---

## üîß –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ session cookies

–í `server/index-docker.js` –∏ `server/index.js`:

```javascript
cookie: {
  secure: false,        // –î–ª—è HTTP (–Ω–µ HTTPS)
  httpOnly: true,
  sameSite: 'lax',     // –í–∞–∂–Ω–æ –¥–ª—è —Ä–∞–±–æ—Ç—ã cookies
  maxAge: 24 * 60 * 60 * 1000
}
```

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

### 1. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å—Ç–∞—Ä—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
```bash
docker-compose down -v
```

### 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å –Ω–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π
```bash
docker-compose up --build -d
```

### 3. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 20 —Å–µ–∫—É–Ω–¥
```bash
timeout /t 20
```

### 4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å
```bash
docker ps
```

### 5. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä
```
http://localhost:5000
```

### 6. –û—á–∏—Å—Ç–∏—Ç–µ cookies
- F12 ‚Üí Application ‚Üí Cookies ‚Üí Clear all
- –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)

### 7. –ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ—Å—å
- Email: test3@student.com
- –ü–∞—Ä–æ–ª—å: Test123!
- –ö–æ–¥: 1111

---

## ‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

–ü–æ—Å–ª–µ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏/–∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
- ‚úÖ –ü–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ /dashboard
- ‚úÖ –ù–ï–¢ –æ—à–∏–±–æ–∫ 401 –≤ –∫–æ–Ω—Å–æ–ª–∏
- ‚úÖ –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è: "–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, [–ò–º—è]!"
- ‚úÖ –ë–∞–ª–∞–Ω—Å: 1000 ‚ÇΩ
- ‚úÖ –ú–µ–Ω—é –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è
- ‚úÖ –ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å –∑–∞–∫–∞–∑—ã

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ session

### –í –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞ (F12):
```javascript
// –ü—Ä–æ–≤–µ—Ä—å—Ç–µ cookies
document.cookie
```

–î–æ–ª–∂–µ–Ω –±—ã—Ç—å cookie —Å –∏–º–µ–Ω–µ–º `connect.sid`

### –í –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞:
```bash
docker-compose logs app -f
```

–ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–∞—Ö –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å:
```
User: { id: '...', email: '...', role: 'student', balance: 1000 }
```

–ê –ù–ï:
```
User: undefined
```

---

## üîç Troubleshooting

### –ï—Å–ª–∏ –≤—Å–µ –µ—â–µ –æ—à–∏–±–∫–∏ 401:

#### 1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ CORS
```bash
docker-compose logs app | findstr "origin"
```
–î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `origin: http://localhost:5000`

#### 2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ cookie settings
```bash
docker-compose logs app | findstr "secure"
```
–î–æ–ª–∂–Ω–æ –±—ã—Ç—å: `secure: false`

#### 3. –û—á–∏—Å—Ç–∏—Ç–µ –≤—Å–µ
```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose down -v

# –û—á–∏—Å—Ç–∏—Ç–µ Docker
docker system prune -a -f

# –ó–∞–ø—É—Å—Ç–∏—Ç–µ –∑–∞–Ω–æ–≤–æ
docker-compose up --build -d
```

#### 4. –û—á–∏—Å—Ç–∏—Ç–µ –±—Ä–∞—É–∑–µ—Ä
- –û—á–∏—Å—Ç–∏—Ç–µ –≤—Å–µ cookies
- –ó–∞–∫—Ä–æ–π—Ç–µ –≤—Å–µ –≤–∫–ª–∞–¥–∫–∏
- –û—Ç–∫—Ä–æ–π—Ç–µ –≤ —Ä–µ–∂–∏–º–µ –∏–Ω–∫–æ–≥–Ω–∏—Ç–æ
- –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞

---

## üìù –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ bat-—Ñ–∞–π–ª—ã

–í—Å–µ bat-—Ñ–∞–π–ª—ã —Ç–µ–ø–µ—Ä—å –∏—Å–ø–æ–ª—å–∑—É—é—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π `docker-compose.yml`:

- ‚úÖ `docker-start.bat` - –∑–∞–ø—É—Å–∫
- ‚úÖ `docker-stop.bat` - –æ—Å—Ç–∞–Ω–æ–≤–∫–∞
- ‚úÖ `docker-rebuild.bat` - –ø–µ—Ä–µ—Å–±–æ—Ä–∫–∞
- ‚úÖ `docker-logs.bat` - –ª–æ–≥–∏
- ‚úÖ `DEBUG_REGISTRATION.bat` - –æ—Ç–ª–∞–¥–∫–∞

---

## üéØ –§–∏–Ω–∞–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç

- [x] docker-compose.yml –æ–±–Ω–æ–≤–ª–µ–Ω
- [x] PostgreSQL volume path –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- [x] FRONTEND_URL –∏—Å–ø—Ä–∞–≤–ª–µ–Ω
- [x] Session cookies –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã
- [x] –ß–∏—Å–ª–æ–≤—ã–µ –ø–æ–ª—è –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—Ç—Å—è
- [x] Bat-—Ñ–∞–π–ª—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
- [ ] –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω—ã
- [ ] Cookies –æ—á–∏—â–µ–Ω—ã
- [ ] –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∞
- [ ] Session —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## üöÄ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### 1. –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
```bash
docker-compose down -v
docker-compose up --build -d
```

### 2. –ü–æ–¥–æ–∂–¥–∏—Ç–µ 20 —Å–µ–∫—É–Ω–¥
```bash
timeout /t 20
```

### 3. –û—Ç–∫—Ä–æ–π—Ç–µ –±—Ä–∞—É–∑–µ—Ä
```
http://localhost:5000
```

### 4. –û—á–∏—Å—Ç–∏—Ç–µ cookies –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã Docker Compose –±–µ–∑ —É–∫–∞–∑–∞–Ω–∏—è —Ñ–∞–π–ª–∞!

```bash
# –ü—Ä–æ—Å—Ç–æ:
docker-compose up -d

# –í–º–µ—Å—Ç–æ:
docker-compose -f docker-compose.simple.yml up -d
```

**–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å!** üöÄ

---

**–í–µ—Ä—Å–∏—è:** 1.0.5  
**–î–∞—Ç–∞:** 2024-01-24  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é

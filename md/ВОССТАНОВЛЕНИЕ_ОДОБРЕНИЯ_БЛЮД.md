# üîß –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –æ–¥–æ–±—Ä–µ–Ω–∏—è –±–ª—é–¥

## –î–∞—Ç–∞: 9 —Ñ–µ–≤—Ä–∞–ª—è 2026

---

## ‚ùå –ü—Ä–æ–±–ª–µ–º–∞

–ü–æ—Å–ª–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É–¥–∞–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –ø–µ—Ä–µ—Å—Ç–∞–ª–æ —Ä–∞–±–æ—Ç–∞—Ç—å –æ–¥–æ–±—Ä–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –±–ª—é–¥.

---

## üîç –ü—Ä–∏—á–∏–Ω–∞

–ü—Ä–∏ –æ–¥–æ–±—Ä–µ–Ω–∏–∏ –±–ª—é–¥–∞ –ø–æ–ª–µ `ingredients` –ø—Ä–∏—Ö–æ–¥–∏—Ç –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ JSON, –∞ –Ω–µ –∫–∞–∫ –º–∞—Å—Å–∏–≤. –ü–æ–ø—ã—Ç–∫–∞ –∏—Ç–µ—Ä–∞—Ü–∏–∏ –ø–æ —Å—Ç—Ä–æ–∫–µ –≤—ã–∑—ã–≤–∞–ª–∞ –æ—à–∏–±–∫—É.

### –ö–æ–¥ —Å –æ—à–∏–±–∫–æ–π:

```javascript
const ingredients = request.ingredients // –ú–æ–∂–µ—Ç –±—ã—Ç—å —Å—Ç—Ä–æ–∫–æ–π!

for (const ingredient of ingredients) {  // ‚ùå –û—à–∏–±–∫–∞ –µ—Å–ª–∏ —Å—Ç—Ä–æ–∫–∞
  // ...
}
```

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ JSON –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö:

```javascript
// Parse ingredients if it's a string
let ingredients = request.ingredients
if (typeof ingredients === 'string') {
  try {
    ingredients = JSON.parse(ingredients)
  } catch (e) {
    console.error('Failed to parse ingredients:', e)
    return res.status(400).json({ error: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤' })
  }
}

// Ensure ingredients is an array
if (!Array.isArray(ingredients)) {
  return res.status(400).json({ error: '–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º' })
}

// Now safe to iterate
for (const ingredient of ingredients) {
  // ...
}
```

---

## üìù –ü–æ–ª–Ω—ã–π –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –∫–æ–¥

### server/routes/admin.js - –ú–∞—Ä—à—Ä—É—Ç –æ–¥–æ–±—Ä–µ–Ω–∏—è

```javascript
router.post('/menu-requests/:id/approve', async (req, res) => {
  try {
    if (!req.session.user || req.session.user.role !== 'admin') {
      return res.status(401).json({ error: 'Unauthorized' })
    }

    const { id } = req.params
    const { adminComment, startDate, endDate } = req.body

    // Get request details
    const request = await getQuery(`
      SELECT * FROM menu_requests WHERE id = ?
    `, [id])

    if (!request) {
      return res.status(404).json({ error: '–ó–∞—è–≤–∫–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞' })
    }

    // Parse ingredients if it's a string
    let ingredients = request.ingredients
    if (typeof ingredients === 'string') {
      try {
        ingredients = JSON.parse(ingredients)
      } catch (e) {
        console.error('Failed to parse ingredients:', e)
        return res.status(400).json({ error: '–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç–æ–≤' })
      }
    }

    // Ensure ingredients is an array
    if (!Array.isArray(ingredients)) {
      return res.status(400).json({ error: '–ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –º–∞—Å—Å–∏–≤–æ–º' })
    }

    // Create menu items for date range
    const start = new Date(startDate)
    const end = new Date(endDate)

    for (let date = new Date(start); date <= end; date.setDate(date.getDate() + 1)) {
      const dateStr = date.toISOString().split('T')[0]
      const menuId = uuidv4()

      // Add menu item
      await runQuery(`
        INSERT INTO menu (id, day, name, description, price, meal_type)
        VALUES (?, ?, ?, ?, ?, ?)
      `, [menuId, dateStr, request.name, request.description, request.price, request.meal_type])

      // Add ingredients
      for (const ingredient of ingredients) {
        await runQuery(`
          INSERT INTO menu_ingredients (id, menu_id, ingredient_name, quantity, unit)
          VALUES (?, ?, ?, ?, ?)
        `, [uuidv4(), menuId, ingredient.name, ingredient.quantity, ingredient.unit])
      }
    }

    // Update request status
    await runQuery(`
      UPDATE menu_requests 
      SET status = '–æ–¥–æ–±—Ä–µ–Ω–∞', 
          admin_comment = ?,
          reviewed_by = ?,
          reviewed_at = CURRENT_TIMESTAMP
      WHERE id = ?
    `, [adminComment, req.session.user.id, id])

    console.log(`‚úÖ Admin ${req.session.user.email} approved menu request: ${request.name}`)
    res.json({ message: '–ó–∞—è–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞, –±–ª—é–¥–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –º–µ–Ω—é' })
  } catch (error) {
    console.error('Approve menu request error:', error)
    console.error('Error details:', error.message)
    res.status(500).json({ error: '–û—à–∏–±–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∏—è –∑–∞—è–≤–∫–∏' })
  }
})
```

---

## ‚úÖ –ß—Ç–æ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

1. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –ø–∞—Ä—Å–∏–Ω–≥ JSON –¥–ª—è `ingredients`
2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–∞ –¥–∞–Ω–Ω—ã—Ö
3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –ø–∞—Ä—Å–∏–Ω–≥–∞
4. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —É—Å–ø–µ—à–Ω–æ–≥–æ –æ–¥–æ–±—Ä–µ–Ω–∏—è
5. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –¥–µ—Ç–∞–ª—å–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:

1. **–í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –ø–æ–≤–∞—Ä**
2. **–°–æ–∑–¥–∞–π—Ç–µ –∑–∞—è–≤–∫—É –Ω–∞ –Ω–æ–≤–æ–µ –±–ª—é–¥–æ**
3. **–í–æ–π–¥–∏—Ç–µ –∫–∞–∫ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä**
4. **–ü–µ—Ä–µ–π–¥–∏—Ç–µ –Ω–∞ –≤–∫–ª–∞–¥–∫—É "–ù–æ–≤—ã–µ –±–ª—é–¥–∞"**
5. **–ù–∞–∂–º–∏—Ç–µ "‚úÖ –û–¥–æ–±—Ä–∏—Ç—å"**
6. **–£–∫–∞–∂–∏—Ç–µ –ø–µ—Ä–∏–æ–¥ –¥–µ–π—Å—Ç–≤–∏—è**
7. **–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –æ–¥–æ–±—Ä–µ–Ω–∏–µ**

### –û–∂–∏–¥–∞–µ–º–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ:

‚úÖ –ó–∞—è–≤–∫–∞ –æ–¥–æ–±—Ä–µ–Ω–∞
‚úÖ –ë–ª—é–¥–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –≤ –º–µ–Ω—é –Ω–∞ —É–∫–∞–∑–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥
‚úÖ –ò–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
‚úÖ –°—Ç–∞—Ç—É—Å –∑–∞—è–≤–∫–∏ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ "–æ–¥–æ–±—Ä–µ–Ω–∞"
‚úÖ –í –ª–æ–≥–∞—Ö: `‚úÖ Admin admin@example.com approved menu request: –ù–∞–∑–≤–∞–Ω–∏–µ –±–ª—é–¥–∞`

---

## üìä –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤—Å–µ—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤

### –í—Å–µ –º–∞—Ä—à—Ä—É—Ç—ã admin.js —Ä–∞–±–æ—Ç–∞—é—Ç:

1. ‚úÖ `GET /api/admin/stats` - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
2. ‚úÖ `GET /api/admin/users` - –°–ø–∏—Å–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
3. ‚úÖ `GET /api/admin/recent-orders` - –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–∫–∞–∑—ã
4. ‚úÖ `GET /api/admin/purchase-requests` - –ó–∞—è–≤–∫–∏ –Ω–∞ –∑–∞–∫—É–ø–∫—É
5. ‚úÖ `PUT /api/admin/purchase-requests/:id` - –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–∞—è–≤–∫–∏
6. ‚úÖ `GET /api/admin/menu-requests` - –ó–∞—è–≤–∫–∏ –Ω–∞ –±–ª—é–¥–∞
7. ‚úÖ `POST /api/admin/menu-requests/:id/approve` - –û–¥–æ–±—Ä–µ–Ω–∏–µ –±–ª—é–¥–∞ ‚≠ê
8. ‚úÖ `POST /api/admin/menu-requests/:id/reject` - –û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ –±–ª—é–¥–∞
9. ‚úÖ `GET /api/admin/reports` - –û—Ç—á–µ—Ç—ã
10. ‚úÖ `PUT /api/admin/users/:id` - –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
11. ‚úÖ `DELETE /api/admin/users/:id` - –£–¥–∞–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

---

## üéØ –ò—Ç–æ–≥

–û–¥–æ–±—Ä–µ–Ω–∏–µ –±–ª—é–¥ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!

**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ:** 9 —Ñ–µ–≤—Ä–∞–ª—è 2026

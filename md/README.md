# Система управления школьной столовой

Комплексное веб-приложение для управления школьной столовой с разграничением прав доступа для учеников, поваров и администраторов.

## Описание

Система автоматизирует весь процесс работы столовой от планирования меню до выдачи заказов. Построена на современных веб-технологиях и обеспечивает безопасное, масштабируемое решение для образовательных учреждений любого размера.

## Основной функционал

### Портал ученика
- Регистрация аккаунта с подтверждением email
- Просмотр меню с планированием на 30 дней вперед
- Заказ отдельных блюд и управление абонементами
- Электронный кошелек с отслеживанием баланса
- Генерация QR-кода для получения заказа
- Полная история заказов и транзакций

### Интерфейс повара
- Управление очередью заказов в реальном времени
- Сканер QR-кодов для проверки заказов
- Отслеживание выдачи блюд
- Ежедневная статистика и метрики
- Автоматическое списание со склада

### Панель администратора
- Управление пользователями всех ролей
- Финансовая отчетность и аналитика выручки
- Общая статистика системы
- Мониторинг заказов
- Контроль складских запасов

## Технологический стек

### Frontend
- React 18.2 с функциональными компонентами и хуками
- React Router DOM для маршрутизации
- Vite для оптимизированной сборки
- Современный CSS с адаптивным дизайном

### Backend
- Node.js с фреймворком Express
- PostgreSQL для production-окружения
- SQLite для разработки и тестирования
- JWT-аутентификация
- bcrypt для хеширования паролей

### Безопасность
- Helmet.js для защиты HTTP-заголовков
- Express rate limiting
- Настройка CORS
- AES-256 шифрование конфиденциальных данных
- Поддержка двухфакторной аутентификации
- Логирование транзакций и аудит

## Установка

### Требования
- Node.js 16 или выше
- PostgreSQL 14+ (production) или SQLite (разработка)
- Docker и Docker Compose (опционально)

### Стандартная установка

1. Клонируйте репозиторий и установите зависимости:
```bash
npm install
```

2. Настройте переменные окружения:
```bash
cp .env.example .env
# Отредактируйте .env под вашу конфигурацию
```

3. Запустите backend-сервер:
```bash
npm run server
```

4. Запустите development-сервер:
```bash
npm run dev
```

Приложение доступно по адресу `http://localhost:3000`

### Развертывание через Docker

Для контейнеризованного развертывания:

```bash
docker-compose up -d
```

Приложение будет доступно по адресу `http://localhost:5000`

## Конфигурация

### Переменные окружения

Основные параметры конфигурации в `.env`:

```env
NODE_ENV=production
PORT=5000
DATABASE_URL=postgresql://user:pass@host:5432/db
SESSION_SECRET=ваш-секретный-ключ
ACCESS_TOKEN_SECRET=ваш-jwt-секрет
ENCRYPTION_KEY=ваш-ключ-шифрования
ADMIN_SECRET_CODE=код-регистрации-админа
CHEF_SECRET_CODE=код-регистрации-повара
EMAIL_HOST=smtp.gmail.com
EMAIL_USER=ваш-email@gmail.com
EMAIL_PASSWORD=пароль-приложения
```

### Настройка базы данных

Приложение автоматически инициализирует схему базы данных при первом запуске. Для ручной настройки:

```bash
# PostgreSQL
psql -U postgres -d school_canteen -f init-db.sql

# SQLite
sqlite3 school_canteen.db < init-db.sql
```

## Документация API

### Аутентификация

- `POST /api/auth/register` - Регистрация пользователя
- `POST /api/auth/login` - Вход в систему
- `POST /api/auth/logout` - Завершение сессии
- `GET /api/auth/check` - Проверка сессии
- `POST /api/auth/verify-email` - Подтверждение email
- `POST /api/auth/forgot-password` - Запрос сброса пароля
- `POST /api/auth/reset-password` - Подтверждение сброса пароля

### Управление меню

- `GET /api/menu` - Получить список блюд
- `GET /api/menu/date/:date` - Меню на конкретную дату
- `POST /api/menu` - Создать блюдо (только админ)
- `PUT /api/menu/:id` - Обновить блюдо (только админ)
- `DELETE /api/menu/:id` - Удалить блюдо (только админ)

### Обработка заказов

- `GET /api/orders` - История заказов пользователя
- `POST /api/orders` - Создать новый заказ
- `GET /api/orders/:id` - Детали заказа
- `PUT /api/orders/:id/cancel` - Отменить заказ

### Система QR-кодов

- `POST /api/qrcode/generate/order/:orderId` - Сгенерировать QR-код заказа
- `POST /api/qrcode/validate` - Проверить QR-код
- `POST /api/qrcode/issue/:orderId` - Выдать заказ по QR-коду

### Операции повара

- `GET /api/chef/pending-meals` - Заказы на выдачу
- `GET /api/chef/issued-today` - Журнал выдачи за день
- `POST /api/chef/issue-meal` - Отметить выдачу блюда

### Административные функции

- `GET /api/admin/stats` - Статистика системы
- `GET /api/admin/users` - Управление пользователями
- `GET /api/admin/orders` - Все заказы
- `GET /api/admin/revenue` - Финансовые отчеты
- `POST /api/admin/balance/:userId` - Изменить баланс пользователя

## Project Structure

```
school-canteen/
├── src/                          # Frontend source
│   ├── components/               # React components
│   │   ├── StudentDashboard.jsx
│   │   ├── ChefDashboard.jsx
│   │   └── AdminDashboard.jsx
│   ├── pages/                    # Route pages
│   │   ├── Home.jsx
│   │   ├── StudentAuth.jsx
│   │   ├── ChefAuth.jsx
│   │   ├── AdminAuth.jsx
│   │   ├── Dashboard.jsx
│   │   └── ForgotPassword.jsx
│   ├── App.jsx
│   ├── main.jsx
│   └── index.css
├── server/                       # Backend source
│   ├── routes/                   # API routes
│   │   ├── auth.js
│   │   ├── menu.js
│   │   ├── orders.js
│   │   ├── subscriptions.js
│   │   ├── chef.js
│   │   └── admin.js
│   ├── middleware/               # Express middleware
│   │   ├── auth.js
│   │   ├── rateLimiter.js
│   │   ├── jwt.js
│   │   └── security.js
│   ├── utils/                    # Utility functions
│   │   ├── phone.js
│   │   ├── emailService.js
│   │   ├── encryption.js
│   │   ├── twoFactor.js
│   │   ├── qrCode.js
│   │   └── transactionLogger.js
│   ├── database.js
│   ├── database-postgres.js
│   └── index.js
├── docker-compose.yml
├── Dockerfile
├── package.json
└── vite.config.js
```

## Схема базы данных

### Основные таблицы

- `users` - Учетные записи пользователей и аутентификация
- `menu` - Блюда меню и цены
- `orders` - Записи заказов и статусы
- `subscriptions` - Абонементы на питание
- `issued_meals` - Отслеживание выдачи
- `inventory` - Управление складом
- `menu_requests` - Предложения учеников по меню
- `notifications` - Системные уведомления
- `transaction_logs` - Журнал аудита
- `password_resets` - Токены восстановления пароля

## Функции безопасности

### Аутентификация
- Хеширование паролей bcrypt с солью
- JWT-токены с механизмом обновления
- HTTP-only защищенные cookies
- Управление сессиями с истечением срока
- Обязательное подтверждение email
- Сброс пароля с ограниченными по времени токенами

### Защита данных
- AES-256 шифрование конфиденциальных данных
- Защита от SQL-инъекций через параметризованные запросы
- XSS-защита через санитизацию ввода
- CSRF-валидация токенов
- Rate limiting на endpoints аутентификации
- Логирование транзакций для соответствия аудиту

### Контроль доступа
- Ролевые разрешения (RBAC)
- Секретные коды для регистрации персонала
- Валидация сессий на защищенных маршрутах
- Проверка авторизации API endpoints

## Тестирование

### Тестовые аккаунты

Для разработки и тестирования:

```
Ученик:
Email: student@test.com
Пароль: test123

Повар:
Email: chef@test.com
Пароль: test123

Администратор:
Email: admin@test.com
Пароль: test123
```

### Запуск тестов

```bash
# Модульные тесты
npm test

# Интеграционные тесты
npm run test:integration

# End-to-end тесты
npm run test:e2e
```

## Развертывание

### Чеклист для production

- [ ] Установить `NODE_ENV=production`
- [ ] Настроить PostgreSQL базу данных
- [ ] Сгенерировать безопасные случайные секреты
- [ ] Включить HTTPS/SSL
- [ ] Настроить email-сервис
- [ ] Настроить стратегию резервного копирования
- [ ] Настроить мониторинг и логирование
- [ ] Проверить заголовки безопасности
- [ ] Протестировать все критические пути
- [ ] Задокументировать процедуры развертывания

### Docker Production

```bash
docker-compose -f docker-compose.production.yml up -d
```

### Ручное развертывание

Подробные инструкции по развертыванию на различных платформах (VPS, Heroku, Render) см. в `server/md/DEPLOYMENT.md`.

## Производительность

- Среднее время ответа API: < 100мс
- Размер frontend-бандла: ~200KB (gzipped)
- Оптимизация запросов БД с индексами
- Стратегия кеширования данных меню
- Ленивая загрузка компонентов дашборда

## Поддержка браузеров

- Chrome 90+
- Firefox 88+
- Safari 14+
- Edge 90+

## Участие в разработке

Приветствуются любые вклады. Ознакомьтесь с `CONTRIBUTING.md` для получения информации о:
- Стандартах кода
- Git workflow и стратегии ветвления
- Процессе pull request
- Требованиях к тестированию

## Документация

Дополнительная документация доступна в `server/md/`:
- `DOCKER_GUIDE.md` - Руководство по Docker
- `QR_CODE_SYSTEM.md` - Детали реализации QR-кодов
- `INVENTORY_SYSTEM.md` - Управление складом
- `SECURITY_AUDIT.md` - Реализация безопасности
- `API_REFERENCE.md` - Полная документация API

## Устранение неполадок

### Распространенные проблемы

**Порт уже используется:**
```bash
# Измените порт в .env
PORT=5001
```

**Ошибка подключения к БД:**
- Проверьте, что PostgreSQL запущен
- Проверьте конфигурацию DATABASE_URL
- Убедитесь, что база данных существует и у пользователя есть права

**Email не отправляется:**
- Проверьте SMTP-учетные данные
- Проверьте настройки файрвола
- Просмотрите логи email-сервиса

Подробное руководство по устранению неполадок см. в `server/md/TROUBLESHOOTING.md`

## Лицензия

MIT License - подробности в файле LICENSE

## Поддержка

По вопросам и проблемам:
- GitHub Issues: Сообщения об ошибках и запросы функций
- Документация: Подробные руководства в `/server/md/`
- Email: support@school-canteen.com

## История изменений

См. `CHANGELOG.md` для истории версий и примечаний к релизам.

---

**Версия:** 2.0.0  
**Последнее обновление:** Февраль 2026  
**Статус:** Готов к production

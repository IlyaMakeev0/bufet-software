# üîí HTTPS –ó–∞–ø—É—Å–∫ –≤ Ubuntu

## ‚úÖ –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ü–æ—Ä—Ç—ã

–ü–æ—Å–∫–æ–ª—å–∫—É –ø–æ—Ä—Ç 443 –∑–∞–Ω—è—Ç, –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –ø–æ—Ä—Ç—ã:
- **8443** - HTTPS (–≤–º–µ—Å—Ç–æ 443)
- **8080** - HTTP —Ä–µ–¥–∏—Ä–µ–∫—Ç (–≤–º–µ—Å—Ç–æ 80)

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ:** –ù–µ —Ç—Ä–µ–±—É—é—Ç—Å—è –ø—Ä–∞–≤–∞ root!

---

## üöÄ –ó–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Docker (–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)

### –®–∞–≥ 1: –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º

```bash
chmod +x docker-start-https.sh
```

### –®–∞–≥ 2: –ó–∞–ø—É—Å—Ç–∏—Ç—å Docker

```bash
./docker-start-https.sh
```

**–ò–ª–∏ –≤—Ä—É—á–Ω—É—é:**

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose -f docker-compose.https.yml down

# –°–æ–±—Ä–∞—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose -f docker-compose.https.yml up -d --build

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker-compose -f docker-compose.https.yml ps

# –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
docker-compose -f docker-compose.https.yml logs -f
```

---

## üåê –î–æ—Å—Ç—É–ø –∫ –ü—Ä–∏–ª–æ–∂–µ–Ω–∏—é

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω–æ:

- üîí **https://www.autogreatfood.ru:8443**
- üîí **https://autogreatfood.ru:8443**
- üîí **https://localhost:8443**
- üîÑ **http://localhost:8080** (—Ä–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ HTTPS)

---

## üêß –õ–æ–∫–∞–ª—å–Ω—ã–π –ó–∞–ø—É—Å–∫ (–±–µ–∑ Docker)

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ë–µ–∑ –ø—Ä–∞–≤ root (–ø–æ—Ä—Ç—ã > 1024)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä
npm start
```

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ –ø–æ—Ä—Ç–∞—Ö 8080 –∏ 8443 (–Ω–µ —Ç—Ä–µ–±—É—é—Ç root).

### –í–∞—Ä–∏–∞–Ω—Ç 2: –° –ø—Ä–∞–≤–∞–º–∏ root (–ø–æ—Ä—Ç—ã 80 –∏ 443)

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ—Ä—Ç—ã 80 –∏ 443:

```bash
# –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç—ã –≤ .env
# HTTP_PORT=80
# HTTPS_PORT=443

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å sudo
sudo npm start
```

**–ò–ª–∏ —á–µ—Ä–µ–∑ Node:**

```bash
sudo node server/index.js
```

---

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker –±–µ–∑ sudo

–ï—Å–ª–∏ Docker —Ç—Ä–µ–±—É–µ—Ç sudo, –¥–æ–±–∞–≤—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker:

```bash
# –î–æ–±–∞–≤–∏—Ç—å —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker
sudo usermod -aG docker $USER

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è (–Ω—É–∂–Ω–æ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω–∏—Ç—å—Å—è)
newgrp docker

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
docker ps
```

–ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ Docker –±—É–¥–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –±–µ–∑ sudo.

---

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ –ü–æ—Ä—Ç–æ–≤

### –£–∑–Ω–∞—Ç—å, —á—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç –ø–æ—Ä—Ç 443

```bash
sudo lsof -i :443
# –∏–ª–∏
sudo netstat -tulpn | grep :443
# –∏–ª–∏
sudo ss -tulpn | grep :443
```

### –û—Å–≤–æ–±–æ–¥–∏—Ç—å –ø–æ—Ä—Ç (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

```bash
# –ù–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å
sudo lsof -i :443

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å (–∑–∞–º–µ–Ω–∏—Ç–µ PID –Ω–∞ –Ω–æ–º–µ—Ä –ø—Ä–æ—Ü–µ—Å—Å–∞)
sudo kill -9 PID
```

---

## üß™ –ü—Ä–æ–≤–µ—Ä–∫–∞ –†–∞–±–æ—Ç—ã

### –ß–µ—Ä–µ–∑ curl

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ HTTPS
curl -k -I https://localhost:8443

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
curl -I http://localhost:8080
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: 301 Moved Permanently
```

### –ß–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä

1. –û—Ç–∫—Ä–æ–π—Ç–µ https://localhost:8443
2. –ë—Ä–∞—É–∑–µ—Ä –ø–æ–∫–∞–∂–µ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ (–¥–ª—è localhost —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
3. –ù–∞–∂–º–∏—Ç–µ "–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ" ‚Üí "–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å"
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞–º–æ—á–µ–∫ üîí

---

## üìä –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ Docker

### –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤

```bash
# –í—Å–µ –ª–æ–≥–∏
docker-compose -f docker-compose.https.yml logs

# –õ–æ–≥–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose -f docker-compose.https.yml logs -f

# –õ–æ–≥–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker-compose -f docker-compose.https.yml logs app
```

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
docker-compose -f docker-compose.https.yml down

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∏ —É–¥–∞–ª–∏—Ç—å volumes
docker-compose -f docker-compose.https.yml down -v
```

### –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫

```bash
# –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose -f docker-compose.https.yml restart

# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç—å
docker-compose -f docker-compose.https.yml up -d --build
```

---

## üÜò –†–µ—à–µ–Ω–∏–µ –ü—Ä–æ–±–ª–µ–º

### –û—à–∏–±–∫–∞ "permission denied" –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ Docker

**–†–µ—à–µ–Ω–∏–µ 1:** –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker
```bash
sudo usermod -aG docker $USER
newgrp docker
```

**–†–µ—à–µ–Ω–∏–µ 2:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å sudo
```bash
sudo ./docker-start-https.sh
```

### –û—à–∏–±–∫–∞ "port is already allocated"

**–ü—Ä–∏—á–∏–Ω–∞:** –ü–æ—Ä—Ç –∑–∞–Ω—è—Ç –¥—Ä—É–≥–∏–º –ø—Ä–æ—Ü–µ—Å—Å–æ–º

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ù–∞–π—Ç–∏ –ø—Ä–æ—Ü–µ—Å—Å
sudo lsof -i :8443
sudo lsof -i :8080

# –û—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ—Ü–µ—Å—Å
sudo kill -9 PID

# –ò–ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç—ã –≤ .env –∏ docker-compose.https.yml
```

### –û—à–∏–±–∫–∞ "Cannot connect to the Docker daemon"

**–ü—Ä–∏—á–∏–Ω–∞:** Docker –Ω–µ –∑–∞–ø—É—â–µ–Ω

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å Docker
sudo systemctl start docker

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
sudo systemctl status docker

# –í–∫–ª—é—á–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫
sudo systemctl enable docker
```

### –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏:**
```bash
docker-compose -f docker-compose.https.yml logs app
```

**–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å:**
```bash
docker-compose -f docker-compose.https.yml ps
```

---

## üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firewall (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)

### UFW (Ubuntu Firewall)

```bash
# –û—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç—ã
sudo ufw allow 8080/tcp
sudo ufw allow 8443/tcp

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
sudo ufw status

# –ï—Å–ª–∏ –Ω—É–∂–Ω—ã —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –ø–æ—Ä—Ç—ã
sudo ufw allow 80/tcp
sudo ufw allow 443/tcp
```

### iptables

```bash
# –û—Ç–∫—Ä—ã—Ç—å –ø–æ—Ä—Ç—ã
sudo iptables -A INPUT -p tcp --dport 8080 -j ACCEPT
sudo iptables -A INPUT -p tcp --dport 8443 -j ACCEPT

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—Ä–∞–≤–∏–ª–∞
sudo iptables-save | sudo tee /etc/iptables/rules.v4
```

---

## üìù –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –¢–µ–∫—É—â–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ (.env)

```env
NODE_ENV=production
HTTP_PORT=8080
HTTPS_PORT=8443
FRONTEND_URL=https://www.autogreatfood.ru
ENABLE_HTTP_REDIRECT=true
```

### –ò–∑–º–µ–Ω–∏—Ç—å –ø–æ—Ä—Ç—ã

–û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ `.env`:
```bash
nano .env
```

–ò–∑–º–µ–Ω–∏—Ç–µ:
```env
HTTP_PORT=–≤–∞—à_–ø–æ—Ä—Ç
HTTPS_PORT=–≤–∞—à_–ø–æ—Ä—Ç
```

–¢–∞–∫–∂–µ –∏–∑–º–µ–Ω–∏—Ç–µ –≤ `docker-compose.https.yml`:
```yaml
ports:
  - "–≤–∞—à_–ø–æ—Ä—Ç:–≤–∞—à_–ø–æ—Ä—Ç"
  - "–≤–∞—à_–ø–æ—Ä—Ç:–≤–∞—à_–ø–æ—Ä—Ç"
```

---

## üéØ –ë—ã—Å—Ç—Ä—ã–π –°—Ç–∞—Ä—Ç

```bash
# 1. –°–¥–µ–ª–∞—Ç—å —Å–∫—Ä–∏–ø—Ç –∏—Å–ø–æ–ª–Ω—è–µ–º—ã–º
chmod +x docker-start-https.sh

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç—å
./docker-start-https.sh

# 3. –û—Ç–∫—Ä—ã—Ç—å –≤ –±—Ä–∞—É–∑–µ—Ä–µ
# https://localhost:8443
```

---

## üìÖ –í–∞–∂–Ω–∞—è –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

- **–ü–æ—Ä—Ç—ã:** 8080 (HTTP) ‚Üí 8443 (HTTPS)
- **–°–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç:** GlobalSign (–¥–æ 30.08.2026)
- **–î–æ–º–µ–Ω:** www.autogreatfood.ru
- **–ü—Ä–∞–≤–∞ root:** –ù–ï —Ç—Ä–µ–±—É—é—Ç—Å—è –¥–ª—è –ø–æ—Ä—Ç–æ–≤ > 1024

---

## üéâ –ì–æ—Ç–æ–≤–æ!

–í–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ HTTPS –Ω–∞ –ø–æ—Ä—Ç–∞—Ö 8080 –∏ 8443!

**–ó–∞–ø—É—Å—Ç–∏—Ç–µ:**
```bash
./docker-start-https.sh
```

**–û—Ç–∫—Ä–æ–π—Ç–µ:**
```
https://localhost:8443
```

**–ù–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å –∑–∞—â–∏—â–µ–Ω–Ω—ã–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ–º!** üîí
